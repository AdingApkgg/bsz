<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>不蒜子 - 极简网页计数器 | Busuanzi Visitor Counter</title>
  
  <!-- SEO Meta -->
  <meta name="description" content="不蒜子是一个简洁的网站访客统计服务，零依赖、高性能。支持 site_pv、site_uv、page_pv 统计，提供 RESTful API 接口。">
  <meta name="keywords" content="busuanzi,不蒜子,网站统计,访客计数器,PV,UV,page view,visitor counter,Rust">
  <meta name="author" content="AdingApkgg">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://{{HOST}}/">
  
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="不蒜子 - 极简网页计数器">
  <meta property="og:description" content="简洁的网站访客统计服务，零依赖、高性能。支持 site_pv、site_uv、page_pv 统计。">
  <meta property="og:url" content="https://{{HOST}}/">
  <meta property="og:site_name" content="Busuanzi">
  <meta property="og:locale" content="zh_CN">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="不蒜子 - 极简网页计数器">
  <meta name="twitter:description" content="简洁的网站访客统计服务，零依赖、高性能。">
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "不蒜子 Busuanzi",
    "description": "简洁的网站访客统计服务，零依赖、高性能",
    "url": "https://{{HOST}}/",
    "applicationCategory": "WebApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CNY"
    },
    "author": {
      "@type": "Person",
      "name": "AdingApkgg",
      "url": "https://github.com/AdingApkgg"
    }
  }
  </script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --bg: #0a0a0a; --card: #141414; --border: #262626; --text: #fafafa; --muted: #a1a1aa; --accent: #3b82f6; --green: #22c55e; }
    body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    .container { max-width: 800px; margin: 0 auto; padding: 3rem 1.5rem; }
    h1 { font-size: 2rem; margin-bottom: 0.5rem; }
    .subtitle { color: var(--muted); margin-bottom: 2rem; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
    h2 { font-size: 1.125rem; margin-bottom: 1rem; color: var(--text); }
    h3 { font-size: 1rem; margin: 1.25rem 0 0.75rem; color: var(--muted); font-weight: 500; }
    p { color: var(--muted); margin-bottom: 0.75rem; }
    pre { background: #0d0d0d; border: 1px solid var(--border); border-radius: 8px; padding: 1rem; overflow-x: auto; font-family: ui-monospace, monospace; font-size: 0.8125rem; line-height: 1.5; margin: 0.75rem 0; }
    code { color: #e5e5e5; }
    .inline-code { background: rgba(59,130,246,0.15); padding: 0.15rem 0.4rem; border-radius: 4px; font-family: ui-monospace, monospace; font-size: 0.8125rem; }
    .k { color: #c792ea; } .s { color: #c3e88d; } .c { color: #545864; } .n { color: #f78c6c; } .f { color: #82aaff; } .t { color: #ffcb6b; }
    table { width: 100%; border-collapse: collapse; margin: 0.75rem 0; }
    th, td { text-align: left; padding: 0.625rem 0.75rem; border-bottom: 1px solid var(--border); font-size: 0.875rem; }
    th { color: var(--muted); font-weight: 500; font-size: 0.8125rem; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    footer { text-align: center; padding: 2rem; color: var(--muted); font-size: 0.875rem; }
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .stat { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; text-align: center; }
    .stat-value { font-size: 2rem; font-weight: 600; color: var(--accent); }
    .stat-label { font-size: 0.875rem; color: var(--muted); margin-top: 0.25rem; }
    .features { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin: 0.75rem 0; }
    .feature { padding: 0.75rem; background: rgba(59,130,246,0.08); border: 1px solid rgba(59,130,246,0.15); border-radius: 8px; font-size: 0.8125rem; text-align: center; }
    .badge { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500; margin-left: 0.5rem; }
    .badge-post { background: rgba(34,197,94,0.15); color: var(--green); }
    .badge-get { background: rgba(59,130,246,0.15); color: var(--accent); }
    .badge-put { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .method-row { display: flex; align-items: center; gap: 0.75rem; padding: 0.625rem 0; border-bottom: 1px solid var(--border); font-size: 0.875rem; }
    .method-row:last-child { border-bottom: none; }
    .method-path { font-family: ui-monospace, monospace; font-size: 0.8125rem; color: var(--text); min-width: 60px; }
    .method-desc { color: var(--muted); }
    .note { background: rgba(59,130,246,0.08); border-left: 3px solid var(--accent); padding: 0.75rem 1rem; border-radius: 0 8px 8px 0; margin: 0.75rem 0; font-size: 0.8125rem; color: var(--muted); }
    .note strong { color: var(--text); }
    .step { counter-increment: step; position: relative; padding-left: 2rem; margin-bottom: 1rem; }
    .step::before { content: counter(step); position: absolute; left: 0; width: 1.5rem; height: 1.5rem; background: var(--accent); color: white; border-radius: 50%; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 600; }
    .steps { counter-reset: step; }
    
    /* Artalk */
    #artalk { margin-top: 0; }
    .atk-main-editor { border-color: var(--border) !important; }
    
    @media (max-width: 768px) {
      .container { padding: 2rem 1rem; }
      h1 { font-size: 1.5rem; }
      .card { padding: 1.25rem; }
      pre { font-size: 0.75rem; padding: 0.75rem; }
      .features { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 480px) {
      .container { padding: 1.5rem 0.75rem; }
      .stats { grid-template-columns: 1fr; }
      .stat-value { font-size: 1.5rem; }
      .features { grid-template-columns: 1fr; }
      h1 { font-size: 1.25rem; }
      h2 { font-size: 1rem; }
      .card { border-radius: 8px; margin-bottom: 1rem; }
    }
  </style>
</head>
<body>
  <main class="container">
    <header>
      <h1>不蒜子.rs</h1>
      <p class="subtitle">简洁的网站访客统计服务 · Rust 高性能实现</p>
    </header>

    <section class="stats" aria-label="实时统计">
      <article class="stat">
        <div class="stat-value" id="site_pv">-</div>
        <div class="stat-label">站点访问 (PV)</div>
      </article>
      <article class="stat">
        <div class="stat-value" id="site_uv">-</div>
        <div class="stat-label">站点访客 (UV)</div>
      </article>
      <article class="stat">
        <div class="stat-value" id="page_pv">-</div>
        <div class="stat-label">本页访问</div>
      </article>
    </section>

    <section class="card">
      <h2>特性</h2>
      <div class="features">
        <div class="feature">零外部依赖</div>
        <div class="feature">单一二进制</div>
        <div class="feature">SQLite 持久化</div>
        <div class="feature">内存级性能</div>
        <div class="feature">兼容原版 busuanzi</div>
        <div class="feature">完整管理后台</div>
      </div>
    </section>

    <section class="card">
      <h2>API 接口</h2>
      <div class="method-row">
        <span class="badge badge-post">POST</span>
        <span class="method-path">/api</span>
        <span class="method-desc">统计并返回 PV/UV</span>
      </div>
      <div class="method-row">
        <span class="badge badge-get">GET</span>
        <span class="method-path">/api</span>
        <span class="method-desc">仅获取 PV/UV（不计数）</span>
      </div>
      <div class="method-row">
        <span class="badge badge-put">PUT</span>
        <span class="method-path">/api</span>
        <span class="method-desc">仅提交统计（不返回）</span>
      </div>
      <div class="method-row">
        <span class="badge badge-get">GET</span>
        <span class="method-path">/ping</span>
        <span class="method-desc">健康检查</span>
      </div>
      
      <div class="note">
        <strong>请求头：</strong>需携带 <code class="inline-code">x-bsz-referer</code> 为当前页面完整 URL。<br>
        <strong>访客识别：</strong>通过 Cookie（<code class="inline-code">busuanziId</code>）自动管理，与原版 busuanzi 兼容。
      </div>
    </section>

    <section class="card">
      <h2>响应格式</h2>
<pre><code>{
  <span class="s">"success"</span>: <span class="k">true</span>,
  <span class="s">"data"</span>: {
    <span class="s">"site_pv"</span>: <span class="n">1234</span>,   <span class="c">// 站点总访问量</span>
    <span class="s">"site_uv"</span>: <span class="n">567</span>,    <span class="c">// 站点独立访客数</span>
    <span class="s">"page_pv"</span>: <span class="n">89</span>      <span class="c">// 当前页面访问量</span>
  }
}</code></pre>
    </section>

    <section class="card">
      <h2>快速接入</h2>
      <p>只需几行代码即可为你的网站添加访客统计：</p>
      <div class="steps">
        <div class="step">
          <strong>发送请求</strong>
<pre><code><span class="k">const</span> res = <span class="k">await</span> <span class="f">fetch</span>(<span class="s">'https://{{HOST}}/api'</span>, {
  method: <span class="s">'POST'</span>,
  credentials: <span class="s">'include'</span>,
  headers: { <span class="s">'x-bsz-referer'</span>: location.href }
});</code></pre>
        </div>
        <div class="step">
          <strong>解析数据</strong>
<pre><code><span class="k">const</span> { data } = <span class="k">await</span> res.<span class="f">json</span>();
<span class="c">// data.site_pv  - 站点 PV</span>
<span class="c">// data.site_uv  - 站点 UV</span>
<span class="c">// data.page_pv  - 页面 PV</span></code></pre>
        </div>
        <div class="step">
          <strong>展示数据</strong>
<pre><code>document.<span class="f">getElementById</span>(<span class="s">'pv'</span>).textContent = data.site_pv;</code></pre>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>完整示例</h2>
      <p>复制以下代码到你的 HTML 页面，修改域名即可使用：</p>
<pre><code><span class="c">&lt;!-- 访客统计展示 --&gt;</span>
&lt;p&gt;本站总访问 &lt;span id=<span class="s">"pv"</span>&gt;-&lt;/span&gt; 次，访客 &lt;span id=<span class="s">"uv"</span>&gt;-&lt;/span&gt; 人&lt;/p&gt;
&lt;p&gt;本页访问 &lt;span id=<span class="s">"ppv"</span>&gt;-&lt;/span&gt; 次&lt;/p&gt;

&lt;script&gt;
(<span class="k">async</span> () =&gt; {
  <span class="k">const</span> res = <span class="k">await</span> <span class="f">fetch</span>(<span class="s">'https://{{HOST}}/api'</span>, {
    method: <span class="s">'POST'</span>,
    credentials: <span class="s">'include'</span>,
    headers: { <span class="s">'x-bsz-referer'</span>: location.href }
  });
  <span class="k">const</span> { success, data } = <span class="k">await</span> res.<span class="f">json</span>();
  <span class="k">if</span> (success) {
    document.<span class="f">getElementById</span>(<span class="s">'pv'</span>).textContent = data.site_pv;
    document.<span class="f">getElementById</span>(<span class="s">'uv'</span>).textContent = data.site_uv;
    document.<span class="f">getElementById</span>(<span class="s">'ppv'</span>).textContent = data.page_pv;
  }
})();
&lt;/script&gt;</code></pre>
    </section>

    <section class="card">
      <h2>仅获取数据（不计数）</h2>
      <p>使用 <code class="inline-code">GET</code> 方法可以获取统计数据但不增加计数，适用于管理页面或仪表盘：</p>
<pre><code><span class="k">const</span> res = <span class="k">await</span> <span class="f">fetch</span>(<span class="s">'https://{{HOST}}/api'</span>, {
  headers: { <span class="s">'x-bsz-referer'</span>: <span class="s">'https://your-site.com/page'</span> }
});
<span class="k">const</span> { data } = <span class="k">await</span> res.<span class="f">json</span>();</code></pre>
    </section>

    <section class="card">
      <h2>静默统计</h2>
      <p>使用 <code class="inline-code">PUT</code> 方法只提交访问记录不返回数据，适用于仅需记录不展示的场景：</p>
<pre><code><span class="f">fetch</span>(<span class="s">'https://{{HOST}}/api'</span>, {
  method: <span class="s">'PUT'</span>,
  credentials: <span class="s">'include'</span>,
  headers: { <span class="s">'x-bsz-referer'</span>: location.href }
});</code></pre>
    </section>

    <section class="card" id="comments">
      <h2>评论</h2>
      <div id="artalk"></div>
    </section>
  </main>

  <footer>
    <nav>
      <a href="https://github.com/AdingApkgg/bsz" rel="noopener">GitHub</a> · 
      <a href="/admin">管理面板</a> · 
      <a href="/llms.txt">AI 文档</a> · 
      <a href="/sitemap.xml">站点地图</a>
    </nav>
    <p style="margin-top:0.5rem">Powered by Rust</p>
  </footer>

  <!-- 统计脚本 -->
  <script>
    (async () => {
      try {
        const res = await fetch('/api', {
          method: 'POST',
          credentials: 'include',
          headers: { 'x-bsz-referer': location.href }
        });
        const { success, data } = await res.json();
        if (success) {
          document.getElementById('site_pv').textContent = data.site_pv.toLocaleString();
          document.getElementById('site_uv').textContent = data.site_uv.toLocaleString();
          document.getElementById('page_pv').textContent = data.page_pv.toLocaleString();
        }
      } catch (e) {}
    })();
  </script>

  <!-- Artalk 评论 -->
  <link rel="stylesheet" href="https://artalk.saop.cc/dist/Artalk.css">
  <script src="https://artalk.saop.cc/dist/Artalk.js"></script>
  <script>
    Artalk.init({
      el: '#artalk',
      pageKey: 'https://bsz.saop.cc/',
      site: '不蒜子.rs',
      server: 'https://artalk.saop.cc',
      darkMode: true,
    });
  </script>
</body>
</html>
